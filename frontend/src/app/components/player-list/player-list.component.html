<mat-card>
  <mat-card-header>
    <mat-card-title>{{ 'PLAYER_RANKINGS' | translate }}</mat-card-title>
  </mat-card-header>

  <mat-card-content>
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>{{ 'SEARCH_PLAYERS' | translate }}</mat-label>
      <input
        matInput
        [(ngModel)]="searchQuery"
        (ngModelChange)="onSearchChange()"
        [placeholder]="'SEARCH_PLACEHOLDER' | translate"
      />
      <mat-icon matPrefix>search</mat-icon>
    </mat-form-field>

    <mat-button-toggle-group 
      [value]="selectedRatingType" 
      (change)="onRatingTypeChange($event.value)"
      aria-label="Select rating type"
      class="rating-type-selector">
      <mat-button-toggle *ngFor="let type of ratingTypes" [value]="type.value">
        {{ type.viewValue | translate }}
      </mat-button-toggle>
    </mat-button-toggle-group>

    <div class="table-container">
      <div *ngIf="loading" class="loading-shade">
        <mat-spinner></mat-spinner>
      </div>

      <table mat-table [dataSource]="players" 
             matSort 
             [matSortActive]="sortActive"
             [matSortDirection]="sortDirection"
             (matSortChange)="onSortChange($event)"
             class="players-table">
        <ng-container matColumnDef="rank">
          <th mat-header-cell *matHeaderCellDef>{{ 'RANK' | translate }}</th>
          <td mat-cell *matCellDef="let player">{{ player.rank }}</td>
        </ng-container>

        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef mat-sort-header="name">{{ 'NAME' | translate }}</th>
          <td mat-cell *matCellDef="let player" class="player-name">
            <a (click)="openPlayerOverlay(player)">{{ player.name }}</a>
          </td>
        </ng-container>

        <ng-container matColumnDef="rating">
          <th mat-header-cell *matHeaderCellDef mat-sort-header="rating">{{ 'RATING' | translate }}</th>
          <td mat-cell *matCellDef="let player">{{ player.rating.toFixed(0) }}</td>
        </ng-container>

        <ng-container matColumnDef="games">
          <th mat-header-cell *matHeaderCellDef mat-sort-header="games_played">{{ 'GAMES' | translate }}</th>
          <td mat-cell *matCellDef="let player">{{ player.gamesPlayed }}</td>
        </ng-container>

        <ng-container matColumnDef="confidence">
          <th mat-header-cell *matHeaderCellDef>{{ 'CONFIDENCE' | translate }}</th>
          <td mat-cell *matCellDef="let player">
            <mat-chip [color]="getConfidenceColor(player.confidenceLevel)" selected>
              {{ player.confidenceLevel | translate }}
            </mat-chip>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="player-row"></tr>
      </table>
    </div>

    <mat-paginator [length]="totalPlayers"
                   [pageSize]="pageSize"
                   [pageSizeOptions]="pageSizeOptions"
                   (page)="onPageChange($event)"
                   showFirstLastButtons>
    </mat-paginator>

    <div *ngIf="!loading && players.length === 0" class="no-results">
      <p>{{ 'NO_PLAYERS_FOUND' | translate }} "{{ searchQuery }}"</p>
    </div>
  </mat-card-content>
</mat-card>