<mat-card *ngIf="facade.state() as state">
  <mat-card-header>
    <mat-card-title>{{ 'PLAYER_RANKINGS' | translate }}</mat-card-title>
  </mat-card-header>

  <mat-card-content>
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>{{ 'SEARCH_PLAYERS' | translate }}</mat-label>
      <input
        matInput
        [(ngModel)]="searchQuery"
        (ngModelChange)="onSearchChange()"
        [placeholder]="'SEARCH_PLACEHOLDER' | translate"
      />
      <mat-icon matPrefix>search</mat-icon>
    </mat-form-field>

    <app-rating-type-selector 
      [selectedType]="state.ratingType" 
      (typeChange)="onRatingTypeChange($event)">
    </app-rating-type-selector>

    <div class="table-container">
      <div *ngIf="facade.loading()" class="loading-shade">
        <mat-spinner></mat-spinner>
      </div>

      <table mat-table [dataSource]="facade.players()" 
             matSort 
             [matSortActive]="state.sortActive"
             [matSortDirection]="state.sortDirection"
             (matSortChange)="onSortChange($event)"
             class="players-table">
        <ng-container matColumnDef="rank">
          <th mat-header-cell *matHeaderCellDef>{{ 'RANK' | translate }}</th>
          <td mat-cell *matCellDef="let player">{{ player.rank }}</td>
        </ng-container>

        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef mat-sort-header="name">{{ 'NAME' | translate }}</th>
          <td mat-cell *matCellDef="let player" class="player-name">
            <a (click)="openPlayerOverlay(player)">{{ player.name }}</a>
          </td>
        </ng-container>

        <ng-container matColumnDef="rating">
          <th mat-header-cell *matHeaderCellDef mat-sort-header="rating">{{ 'RATING' | translate }}</th>
          <td mat-cell *matCellDef="let player">{{ player.rating.toFixed(0) }}</td>
        </ng-container>

        <ng-container matColumnDef="games">
          <th mat-header-cell *matHeaderCellDef mat-sort-header="games_played">{{ 'GAMES' | translate }}</th>
          <td mat-cell *matCellDef="let player">{{ player.gamesPlayed }}</td>
        </ng-container>

        <ng-container matColumnDef="confidence">
          <th mat-header-cell *matHeaderCellDef>{{ 'CONFIDENCE' | translate }}</th>
          <td mat-cell *matCellDef="let player">
            <mat-chip [color]="getConfidenceColor(player.confidenceLevel)" selected>
              {{ player.confidenceLevel | translate }}
            </mat-chip>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="player-row"></tr>
      </table>
    </div>

    <mat-paginator [length]="facade.total()"
                   [pageSize]="state.pageSize"
                   [pageSizeOptions]="pageSizeOptions"
                   [pageIndex]="state.pageIndex"
                   (page)="onPageChange($event)"
                   showFirstLastButtons>
    </mat-paginator>

    <div *ngIf="!facade.loading() && facade.players().length === 0" class="no-results">
      <p>{{ 'NO_PLAYERS_FOUND' | translate }} "{{ searchQuery }}"</p>
    </div>
  </mat-card-content>
</mat-card>