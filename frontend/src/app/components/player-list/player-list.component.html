<mat-card>
  <mat-card-header>
    <mat-card-title>Player Rankings</mat-card-title>
  </mat-card-header>

  <mat-card-content>
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Search players</mat-label>
      <input
        matInput
        [(ngModel)]="searchQuery"
        (ngModelChange)="onSearchChange()"
        placeholder="Type player name..."
      />
      <mat-icon matPrefix>search</mat-icon>
    </mat-form-field>

    <div *ngIf="loading" class="loading-container">
      <mat-spinner></mat-spinner>
    </div>

    <table mat-table [dataSource]="filteredPlayers" *ngIf="!loading" class="players-table">
      <ng-container matColumnDef="rank">
        <th mat-header-cell *matHeaderCellDef>Rank</th>
        <td mat-cell *matCellDef="let player">{{ player.rank }}</td>
      </ng-container>

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let player" class="player-name">
          <a (click)="openPlayerOverlay(player)">{{ player.name }}</a>
        </td>
      </ng-container>

      <ng-container matColumnDef="rating">
        <th mat-header-cell *matHeaderCellDef>Rating</th>
        <td mat-cell *matCellDef="let player">{{ player.rating.toFixed(0) }}</td>
      </ng-container>

      <ng-container matColumnDef="games">
        <th mat-header-cell *matHeaderCellDef>Games</th>
        <td mat-cell *matCellDef="let player">{{ player.games_played }}</td>
      </ng-container>

      <ng-container matColumnDef="confidence">
        <th mat-header-cell *matHeaderCellDef>Confidence</th>
        <td mat-cell *matCellDef="let player">
          <mat-chip [color]="getConfidenceColor(player.confidence_level)" selected>
            {{ player.confidence_level }}
          </mat-chip>
        </td>
      </ng-container>

      <ng-container matColumnDef="change">
        <th mat-header-cell *matHeaderCellDef>Change</th>
        <td mat-cell *matCellDef="let player">
          <span [class]="getChangeColor(player.recent_change)">
            {{ formatChange(player.recent_change) }}
          </span>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="player-row"></tr>
    </table>

    <div *ngIf="!loading && filteredPlayers.length === 0" class="no-results">
      <p>No players found matching "{{ searchQuery }}"</p>
    </div>
  </mat-card-content>
</mat-card>
