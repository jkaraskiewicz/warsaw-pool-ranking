<mat-card>
  <mat-card-header>
    <mat-card-title>Player Rankings</mat-card-title>
  </mat-card-header>

  <mat-card-content>
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Search players</mat-label>
      <input
        matInput
        [(ngModel)]="searchQuery"
        (ngModelChange)="onSearchChange()"
        placeholder="Type player name..."
      />
      <mat-icon matPrefix>search</mat-icon>
    </mat-form-field>

    <mat-button-toggle-group 
      [(ngModel)]="selectedRatingType" 
      (ngModelChange)="onRatingTypeChange($event)"
      aria-label="Select rating type"
      class="rating-type-selector">
      <mat-button-toggle *ngFor="let type of ratingTypes" [value]="type.value">
        {{ type.viewValue }}
      </mat-button-toggle>
    </mat-button-toggle-group>

    <div *ngIf="loading" class="loading-container">
      <mat-spinner></mat-spinner>
    </div>

    <table mat-table [dataSource]="players" 
           matSort (matSortChange)="onSortChange($event)"
           *ngIf="!loading" class="players-table">
      <ng-container matColumnDef="rank">
        <th mat-header-cell *matHeaderCellDef>Rank</th>
        <td mat-cell *matCellDef="let player">{{ player.rank }}</td>
      </ng-container>

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="name">Name</th>
        <td mat-cell *matCellDef="let player" class="player-name">
          <a (click)="openPlayerOverlay(player)">{{ player.name }}</a>
        </td>
      </ng-container>

      <ng-container matColumnDef="rating">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="rating">Rating</th>
        <td mat-cell *matCellDef="let player">{{ player.rating.toFixed(0) }}</td>
      </ng-container>

      <ng-container matColumnDef="games">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="games_played">Games</th>
        <td mat-cell *matCellDef="let player">{{ player.games_played }}</td>
      </ng-container>

      <ng-container matColumnDef="confidence">
        <th mat-header-cell *matHeaderCellDef>Confidence</th>
        <td mat-cell *matCellDef="let player">
          <mat-chip [color]="getConfidenceColor(player.confidence_level)" selected>
            {{ player.confidence_level }}
          </mat-chip>
        </td>
      </ng-container>

      <ng-container matColumnDef="change">
        <th mat-header-cell *matHeaderCellDef>Change</th>
        <td mat-cell *matCellDef="let player">
          <span [class]="getChangeColor(player.recent_change)">
            {{ formatChange(player.recent_change) }}
          </span>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="player-row"></tr>
    </table>

    <mat-paginator [length]="totalPlayers"
                   [pageSize]="pageSize"
                   [pageSizeOptions]="pageSizeOptions"
                   (page)="onPageChange($event)"
                   showFirstLastButtons
                   *ngIf="!loading">
    </mat-paginator>

    <div *ngIf="!loading && players.length === 0" class="no-results">
      <p>No players found matching "{{ searchQuery }}"</p>
    </div>
  </mat-card-content>
</mat-card>
