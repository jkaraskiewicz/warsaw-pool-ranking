<!-- Stats Grid -->
<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-header">
      <div class="stat-icon-wrapper">
        <mat-icon>group</mat-icon>
      </div>
    </div>
    <h3 class="stat-title">{{ 'TOTAL_PLAYERS' | translate }}</h3>
    <p class="stat-value">{{ facade.total() }}</p>
  </div>

  <div class="stat-card">
    <div class="stat-header">
      <div class="stat-icon-wrapper">
        <mat-icon>trending_up</mat-icon>
      </div>
    </div>
    <h3 class="stat-title">{{ 'AVG_RATING' | translate }} ({{'CURRENT_PAGE' | translate}})</h3>
    <p class="stat-value">{{ averageRating() | number:'1.0-0' }}</p>
  </div>

  <div class="stat-card">
    <div class="stat-header">
      <div class="stat-icon-wrapper">
        <mat-icon>emoji_events</mat-icon>
      </div>
    </div>
    <h3 class="stat-title">{{ 'HIGHEST_RATING' | translate }} ({{'CURRENT_PAGE' | translate}})</h3>
    <p class="stat-value">{{ highestRating() | number:'1.0-0' }}</p>
  </div>

  <div class="stat-card">
    <div class="stat-header">
      <div class="stat-icon-wrapper">
        <mat-icon>tag</mat-icon>
      </div>
    </div>
    <h3 class="stat-title">{{ 'TOTAL_GAMES' | translate }} ({{'CURRENT_PAGE' | translate}})</h3>
    <p class="stat-value">{{ totalGames() }}</p>
  </div>
</div>

<!-- Main Content Card -->
<div class="main-card">

  <!-- Toolbar -->
  <div class="card-toolbar">
    <h2 class="card-title">{{ 'PLAYER_RANKINGS' | translate }}</h2>

    <div class="toolbar-actions">
      <!-- Search -->
      <div class="search-wrapper">
        <input
          type="text"
          [placeholder]="'SEARCH_PLACEHOLDER' | translate"
          class="search-input"
          [(ngModel)]="searchQuery"
          (ngModelChange)="onSearchChange()"
        />
        <mat-icon class="search-icon">search</mat-icon>
      </div>

      <!-- Comparison FAB (Contextual) -->
      <button class="btn-primary"
              *ngIf="selection.size === 2"
              (click)="comparePlayers()">
        <mat-icon>compare_arrows</mat-icon>
        {{ 'COMPARISON' | translate }}
      </button>
    </div>
  </div>

  <!-- Rating Type Selector (Tabs style) -->
  <div class="tabs-container">
    <app-rating-type-selector
      [selectedType]="facade.state().ratingType"
      (typeChange)="onRatingTypeChange($event)">
    </app-rating-type-selector>
  </div>

  <!-- Table -->
  <div class="table-responsive">
    <table mat-table [dataSource]="facade.players()" matSort
           (matSortChange)="onSortChange($event)"
           class="custom-table">

      <!-- Select -->
      <ng-container matColumnDef="select">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let player">
          <mat-checkbox (click)="$event.stopPropagation()"
                        (change)="$event ? toggleSelection(player) : null"
                        [checked]="isSelected(player)">
          </mat-checkbox>
        </td>
      </ng-container>

      <!-- Rank -->
      <ng-container matColumnDef="rank">
        <th mat-header-cell *matHeaderCellDef>{{ 'RANK' | translate }}</th>
        <td mat-cell *matCellDef="let player">
          <div class="rank-badge" [ngClass]="'rank-' + player.rank">
            {{ player.rank }}
          </div>
        </td>
      </ng-container>

      <!-- Name -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="name">{{ 'NAME' | translate }}</th>
        <td mat-cell *matCellDef="let player">
          <div class="player-cell">
            <div class="avatar" [ngStyle]="{'background-image': player.avatarUrl ? 'url(' + player.avatarUrl + ')' : 'none'}">
              <ng-container *ngIf="!player.avatarUrl">{{ player.name.charAt(0) }}</ng-container>
            </div>
            <div class="player-info">
              <span class="player-name-text" (click)="openPlayerOverlay(player)">{{ player.name }}</span>
              <span class="player-id">ID: #{{ player.playerId.toString().padStart(4, '0') }}</span>
            </div>
          </div>
        </td>
      </ng-container>

      <!-- Rating -->
      <ng-container matColumnDef="rating">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="rating" class="text-right">{{ 'RATING' | translate }}</th>
        <td mat-cell *matCellDef="let player" class="text-right font-bold text-white">
          {{ player.rating.toFixed(0) }}
        </td>
      </ng-container>

      <!-- Games -->
      <ng-container matColumnDef="games">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="games_played" class="text-right">{{ 'GAMES' | translate }}</th>
        <td mat-cell *matCellDef="let player" class="text-right text-slate-400">
          {{ player.gamesPlayed }}
        </td>
      </ng-container>

      <!-- Matches -->
      <ng-container matColumnDef="matches">
        <th mat-header-cell *matHeaderCellDef class="text-right">{{ 'MATCHES' | translate }}</th>
        <td mat-cell *matCellDef="let player" class="text-right text-slate-400">
          {{ player.matchesPlayed }}
        </td>
      </ng-container>

      <!-- Confidence -->
      <ng-container matColumnDef="confidence">
        <th mat-header-cell *matHeaderCellDef>{{ 'CONFIDENCE' | translate }}</th>
        <td mat-cell *matCellDef="let player">
          <span class="confidence-badge" [ngClass]="player.confidenceLevel">
            {{ player.confidenceLevel | translate }}
          </span>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
    </table>
  </div>

  <!-- Paginator -->
  <mat-paginator [length]="facade.total()"
                 [pageSize]="facade.state().pageSize"
                 [pageSizeOptions]="pageSizeOptions"
                 [pageIndex]="facade.state().pageIndex"
                 (page)="onPageChange($event)"
                 class="custom-paginator">
  </mat-paginator>
</div>
