<div class="comparison-container">
  <div class="header">
    <h2 mat-dialog-title>{{ 'COMPARISON' | translate }}</h2>
    <button mat-icon-button (click)="close()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content>
    <div *ngIf="loading()" class="loading-container">
      <mat-spinner></mat-spinner>
    </div>

    <div *ngIf="comparison() as comp" class="comparison-content">
      <!-- Players Side by Side -->
      <div class="players-row">
        <!-- Player 1 -->
        <div class="player-card">
          <h3>{{ comp.player1?.name }}</h3>
          <div class="stat">
            <span class="label">{{ 'RATING' | translate }}</span>
            <span class="value">{{ comp.player1?.rating?.toFixed(0) }}</span>
          </div>
          <div class="stat">
            <span class="label">{{ 'CONFIDENCE' | translate }}</span>
             <mat-chip [color]="getConfidenceColor(comp.player1?.confidenceLevel || '')" selected>
              {{ (comp.player1?.confidenceLevel || '') | translate }}
            </mat-chip>
          </div>
        </div>

        <!-- Center Stats -->
        <div class="center-stats">
          <div class="prob-box">
            <div class="prob-label">{{ 'WIN_PROBABILITY' | translate }}</div>
            <div class="prob-value">{{ formatProb(comp.probabilityP1Wins) }}</div>
            <div class="prob-sub">for {{ comp.player1?.name }}</div>
          </div>
        </div>

        <!-- Player 2 -->
        <div class="player-card">
          <h3>{{ comp.player2?.name }}</h3>
          <div class="stat">
            <span class="label">{{ 'RATING' | translate }}</span>
            <span class="value">{{ comp.player2?.rating?.toFixed(0) }}</span>
          </div>
           <div class="stat">
            <span class="label">{{ 'CONFIDENCE' | translate }}</span>
             <mat-chip [color]="getConfidenceColor(comp.player2?.confidenceLevel || '')" selected>
              {{ (comp.player2?.confidenceLevel || '') | translate }}
            </mat-chip>
          </div>
        </div>
      </div>

      <!-- Head to Head Stats -->
      <div *ngIf="comp.stats" class="stats-overview">
        <h3>{{ 'TOTAL_STATS' | translate }}</h3>
        <div class="stat-row">
          <span class="label">{{ 'TOTAL_MATCHES' | translate }}:</span>
          <span class="value">{{ comp.stats.totalMatches }}</span>
        </div>
        <div class="stat-row">
          <span class="label">{{ 'MATCH_WINS' | translate }} ({{comp.player1?.name}}):</span>
          <span class="value">{{ comp.stats.player1MatchWins }}</span>
        </div>
        <div class="stat-row">
          <span class="label">{{ 'MATCH_WINS' | translate }} ({{comp.player2?.name}}):</span>
          <span class="value">{{ comp.stats.player2MatchWins }}</span>
        </div>
        <div class="stat-row">
          <span class="label">{{ 'TOTAL_FRAMES' | translate }}:</span>
          <span class="value">{{ comp.stats.totalFrames }}</span>
        </div>
        <div class="stat-row">
          <span class="label">{{ 'FRAME_WINS' | translate }} ({{comp.player1?.name}}):</span>
          <span class="value">{{ comp.stats.player1FrameWins }}</span>
        </div>
        <div class="stat-row">
          <span class="label">{{ 'FRAME_WINS' | translate }} ({{comp.player2?.name}}):</span>
          <span class="value">{{ comp.stats.player2FrameWins }}</span>
        </div>
      </div>

      <!-- Match History -->
      <div class="history-section">
        <h3>{{ 'MATCH_HISTORY' | translate }}</h3>
        <table mat-table [dataSource]="comp.matches" class="matches-table">
          <ng-container matColumnDef="date">
            <th mat-header-cell *matHeaderCellDef>{{ 'DATE' | translate }}</th>
            <td mat-cell *matCellDef="let match">{{ formatDate(match.date) }}</td>
          </ng-container>

          <ng-container matColumnDef="tournament">
            <th mat-header-cell *matHeaderCellDef>{{ 'TOURNAMENT' | translate }}</th>
            <td mat-cell *matCellDef="let match">{{ match.tournamentName }}</td>
          </ng-container>

          <ng-container matColumnDef="score">
            <th mat-header-cell *matHeaderCellDef>{{ 'SCORE' | translate }}</th>
            <td mat-cell *matCellDef="let match">
              {{ match.player1Wins }} - {{ match.player2Wins }}
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
         <div *ngIf="comp.matches.length === 0" class="no-matches">
            No matches found between these players.
         </div>
      </div>
    </div>
  </mat-dialog-content>
</div>
